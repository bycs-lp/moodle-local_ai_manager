{"version":3,"file":"rights_config_table.min.js","sources":["../src/rights_config_table.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module handling the form submission of the statistics tables of local_ai_manager.\n *\n * @module     local_ai_manager/rights_config_table\n * @copyright  2024 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Pending from 'core/pending';\nimport {getString} from 'core/str';\n\nlet table = null;\n\nexport const selectors = {\n    CHECKBOX: 'input[data-userid]',\n    SELECTALLCHECKBOX: '#rights-table-selectall_checkbox',\n    SELECTIONINFO: '#rights-table-selection_info',\n    USERIDS_INPUT_FIELD: '#rights-table-userids'\n};\n\n/**\n * Initialize the bulk handling on the statistics table.\n * @param {string} id the id of the table to operate on\n */\nexport const init = (id) => {\n    const pendingPromise = new Pending('local_ai_manager/rights_config_table');\n    table = document.getElementById(id);\n    table.querySelectorAll(selectors.CHECKBOX).forEach(checkbox => {\n        checkbox.addEventListener('change', event => {\n            updateSelectAllCheckboxState();\n            updateUserIds(event.target);\n            updateSelectionCountInfo();\n        });\n    });\n    table.querySelector(selectors.SELECTALLCHECKBOX).addEventListener('change', event => {\n        updateSelection(event);\n        // If we set the status of the checkboxes via JS there is no change event on the checkboxes,\n        // so we need to manually trigger the update of the user ids.\n        updateUserIds();\n    });\n    updateSelectionCountInfo();\n    // In case the browser remembered the state after site reload, we need to set the initial state of user ids dependent on the\n    // boxes' current state.\n    updateUserIds();\n    pendingPromise.resolve();\n};\n\n/**\n * Update the user ids input field for form submission.\n */\nconst updateUserIds = () => {\n    const userIdsInputField = document.querySelector(selectors.USERIDS_INPUT_FIELD);\n    const userIds = [];\n    document.querySelectorAll(selectors.CHECKBOX).forEach(checkbox => {\n        if (checkbox.checked) {\n            userIds.push(checkbox.dataset.userid);\n        }\n    });\n    userIdsInputField.value = userIds.join(';');\n};\n\n/**\n * Updates the checked states of the user checkboxes according to the change of the \"select/deselect all\" checkbox.\n *\n * @param {object} changedEvent the changed event of the \"select/deselect all\" checkbox\n */\nconst updateSelection = (changedEvent) => {\n    const allBoxes = table.querySelectorAll(selectors.CHECKBOX);\n    if (allBoxes.length === 0) {\n        return;\n    }\n    if (changedEvent.target.checked) {\n        allBoxes.forEach((box) => {\n            if (!box.checked) {\n                box.checked = true;\n            }\n        });\n    } else {\n        allBoxes.forEach((box) => {\n            box.checked = false;\n        });\n    }\n    updateSelectionCountInfo();\n};\n\n/**\n * Updates the \"select/deselect all\" checkbox according to the state of the other checkboxes.\n */\nconst updateSelectAllCheckboxState = () => {\n    const selectAllCheckbox = table.querySelector(selectors.SELECTALLCHECKBOX);\n    selectAllCheckbox.checked = !!areAllBoxesChecked();\n};\n\n/**\n * Helper function to determine if all user checkboxes are checked or not.\n *\n * @returns {bool} true if all boxes are checked, false otherwise\n */\nconst areAllBoxesChecked = () => {\n    const allBoxes = table.querySelectorAll(selectors.CHECKBOX);\n    return Array.from(allBoxes).reduce((a, b) => a && b.checked, true);\n};\n\n/**\n * Returns the amount of currently checked checkboxes.\n *\n * @returns {number} the count of currently checked checkboxes\n */\nconst checkedCheckboxesCount = () => {\n    const allBoxes = table.querySelectorAll(selectors.CHECKBOX);\n    const checkedBoxes = Array.from(allBoxes).filter(checkbox => checkbox.checked);\n    return checkedBoxes.length;\n};\n\n/**\n * Updates the selection count info text box.\n */\nconst updateSelectionCountInfo = async() => {\n    const selectionCountInfoTarget = table.querySelector(selectors.SELECTIONINFO);\n    const infoText = await getString('selecteduserscount', 'local_ai_manager', checkedCheckboxesCount());\n    selectionCountInfoTarget.innerHTML = infoText;\n};\n"],"names":["table","selectors","CHECKBOX","SELECTALLCHECKBOX","SELECTIONINFO","USERIDS_INPUT_FIELD","id","pendingPromise","Pending","document","getElementById","querySelectorAll","forEach","checkbox","addEventListener","event","updateSelectAllCheckboxState","updateUserIds","target","updateSelectionCountInfo","querySelector","updateSelection","resolve","userIdsInputField","userIds","checked","push","dataset","userid","value","join","changedEvent","allBoxes","length","box","areAllBoxesChecked","Array","from","reduce","a","b","async","selectionCountInfoTarget","infoText","filter","checkedCheckboxesCount","innerHTML"],"mappings":";;;;;;;;mKA2BIA,MAAQ,WAECC,UAAY,CACrBC,SAAU,qBACVC,kBAAmB,mCACnBC,cAAe,+BACfC,oBAAqB,oEAOJC,WACXC,eAAiB,IAAIC,iBAAQ,wCACnCR,MAAQS,SAASC,eAAeJ,IAChCN,MAAMW,iBAAiBV,UAAUC,UAAUU,SAAQC,WAC/CA,SAASC,iBAAiB,UAAUC,QAChCC,+BACAC,cAAcF,MAAMG,QACpBC,iCAGRnB,MAAMoB,cAAcnB,UAAUE,mBAAmBW,iBAAiB,UAAUC,QACxEM,gBAAgBN,OAGhBE,mBAEJE,2BAGAF,gBACAV,eAAee,iBAMbL,cAAgB,WACZM,kBAAoBd,SAASW,cAAcnB,UAAUI,qBACrDmB,QAAU,GAChBf,SAASE,iBAAiBV,UAAUC,UAAUU,SAAQC,WAC9CA,SAASY,SACTD,QAAQE,KAAKb,SAASc,QAAQC,WAGtCL,kBAAkBM,MAAQL,QAAQM,KAAK,MAQrCT,gBAAmBU,qBACfC,SAAWhC,MAAMW,iBAAiBV,UAAUC,UAC1B,IAApB8B,SAASC,SAGTF,aAAab,OAAOO,QACpBO,SAASpB,SAASsB,MACTA,IAAIT,UACLS,IAAIT,SAAU,MAItBO,SAASpB,SAASsB,MACdA,IAAIT,SAAU,KAGtBN,6BAMEH,6BAA+B,KACPhB,MAAMoB,cAAcnB,UAAUE,mBACtCsB,UAAYU,sBAQ5BA,mBAAqB,WACjBH,SAAWhC,MAAMW,iBAAiBV,UAAUC,iBAC3CkC,MAAMC,KAAKL,UAAUM,QAAO,CAACC,EAAGC,IAAMD,GAAKC,EAAEf,UAAS,IAiB3DN,yBAA2BsB,gBACvBC,yBAA2B1C,MAAMoB,cAAcnB,UAAUG,eACzDuC,eAAiB,kBAAU,qBAAsB,mBAX5B,YACrBX,SAAWhC,MAAMW,iBAAiBV,UAAUC,iBAC7BkC,MAAMC,KAAKL,UAAUY,QAAO/B,UAAYA,SAASY,UAClDQ,QAQuDY,IAC3EH,yBAAyBI,UAAYH"}